export const metadata = {
 title: "Tracking AddToCart Event for FB Pixel using GTM in ShopifyðŸš€",
 date: "2023-11-14",
 blogId: "00074",
 tags: ["Facebook Pixel", "Shopify", "AddToCart", "Tutorial"],
 draft: false,
 description: "",
 openGraph: {
  images: ["/static/blog/00014.png"],
 },
 embedId: "",
};

<BlogHeader metadata={metadata} />

#### Introduction

The blog will be updated soon

<YoutubeEmbed embedId={metadata.embedId} />

#### Section 03: Advanced Tracking with Enhanced E-Commerce Data

This section is for those who wish to capture more data, like the item ID, name, value, quantity, etc., when the "Add to Cart" event is triggered.

<Note
 title='Tip'
 content="For this section, some programming knowledge is beneficial. If that's not your strength, you can share our document with your developer."
/>

#### Instructions for Developer

Send over [this document](/static/pdf/blog/shopify/configuring-ga4-add-to-cart-event-on-shopify-using-gtm.pdf) to the developer else following the blog below

#### DataLayer Code Snippets Overview

The provided code snippets aim to integrate the `dataLayer` object for Google Tag Manager (GTM) with a Shopify store. The main goal is to send an event called `custom_add_to_cart` whenever a user visits a product page and clicks on the AddToCart button on Shopify.

#### Head DataLayer Code

This code initializes the `dataLayer` array if it hasn't been already. It then checks if the current page template is a 'product' page and renders a specific snippet called 'datalayer-product'.

```jsx
<script>
    window.dataLayer = window.dataLayer || [];
</script>

{%- if template contains 'product' -%}
  {%- render 'datalayer-product', product: product -%}
{%- endif -%}
```

#### Product DataLayer Code

This code snippet contains the main logic for populating the `dataLayer` object with product details whenever a product page is viewed:

1. It first captures the current variant of the product.
2. It constructs an `itemObject` containing various product details.
3. On document load, it pushes this data to the `dataLayer` object.

```jsx
{%- liquid
  assign current_variant = product.selected_or_first_available_variant
-%}

<script>
  console.log("datalayer-product snippet is loaded")
  var itemObject = {
      item_id: {{ current_variant.id | json }},
      id: {{ current_variant.id | json }},
      item_name: {{ product.title | json }},
      currency: {{ shop.currency | json }},
      item_brand: {{ product.vendor | json }},
      item_category: {{ product.type | json }},
      item_variant: {{ current_variant.title | json }},
      price: {{ current_variant.price }} / 100,
      google_business_vertical: 'retail',
      quantity: 1
  }

  document.addEventListener('DOMContentLoaded', () => {
      const addToCartBtn = document.querySelector('[name="add"]')
      addToCartBtn?.addEventListener('click', () => {
          dataLayer.push({ ecommerce: null });
          dataLayer.push({
              event: "custom_add_to_cart",
              ecommerce: {
              currency: {{ shop.currency | json }},
                  items: [itemObject]
              }
          });
      })
  })
</script>
```

#### Theme DataLayer Code

This code renders the `head-datalayer` snippet. Depending on the setup of your Shopify theme, this is likely where the head datalayer code resides. Add this code GTM Body Code.

```jsx
{% render 'head-datalayer' %}
```

#### Steps to Add the DataLayer Code Snippets in Shopify:

1. Backup: Before making any changes, always backup your current theme.
2. Access Theme Files:
   - Login to your Shopify Admin.
   - Go to Online Store > Themes.
   - Click on the "Actions" dropdown for your live theme and select "Edit code".
3. Add Head DataLayer Code:

   - In the left sidebar, locate and click on `theme.liquid`.
   - Insert the "Head DataLayer Code" snippet within the `<head>` tags.

4. Add Product DataLayer Code:

   - Click "Add a new snippet" depending on your Shopify version.
   - Name it `datalayer-product.liquid`.
   - Insert the "Product DataLayer Code" snippet into this new file.
   - Save changes.

5. Add Theme DataLayer Code:

   - Determine where you want this code to render (usually within the `<head>` tags in `theme.liquid`).
   - Insert the "Theme DataLayer Code" snippet in the desired location.
   - Save changes.

6. Test:
   - Visit a product page on your Shopify store and click AddToCart button.
   - Open browser's developer console.
   - Confirm that the `custom_add_to_cart` event is fired and the `dataLayer` object contains the correct product details.

<Note
 title='Tip'
 content="The custom prefixes added to event names (like 'custom_add_to_cart') prevent any conflicts with other possible integrations or plugins that might be using standard event names."
/>

<GiscusComments />
