export const metadata = {
 title:
  "Setting Up Initiate Checkout Event for Facebook Pixel in Shopify with Google Tag Manager!",
 date: "2023-11-15",
 blogId: "00076",
 tags: [
  "Facebook Pixel",
  "Shopify",
  "Google Tag Manager",
  "Tutorial",
  "Begin Checkout",
 ],
 draft: false,
 description: "",
 openGraph: {
  images: ["/static/blog/00016.png"],
 },
 embedId: "gJ3Ve6OJuAE",
};

<BlogHeader metadata={metadata} />

#### Introduction

The Blog will be updated soon

<YoutubeEmbed embedId={metadata.embedId} />

#### Prerequisites

#### Section 02: Begin Checkout DataLayer with Enhanced E-Commerce Data

This section is for those who wish to capture more data, like the item_id, item_name, value, quantity, etc., when the "begin_checkout" event is triggered.

<Note
 title='Tip'
 content="For this section, some programming knowledge is beneficial. If that's not your strength, you can share our document with your developer."
/>

#### Instructions for Developer

Send over [this document](/static/pdf/blog/shopify/configuring-ga4-begin-checkout-event-on-shopify-using-gtm.pdf) to the developer else following the blog below

#### DataLayer Code Snippets Overview

The provided code snippets aim to integrate the `dataLayer` object for Google Tag Manager (GTM) with a Shopify store. The main goal is to send an event called `custom_begin_checkout` whenever a user clicks the Begin Checkout button on the Cart page on Shopify.

#### Head DataLayer Code

This code initializes the `dataLayer` array if it hasn't been already. It then checks if the current page template is a 'product' page and renders a specific snippet called 'datalayer-product'.

```jsx
<script>
    window.dataLayer = window.dataLayer || [];
</script>

{%- render 'datalayer-checkout' -%}
```

#### Checkout DataLayer Code

This code snippet contains the main logic for populating the `dataLayer` object with product details whenever a Begin Checkout Event is triggered on the Cart page:

- Initial Logging:Outputs a message to verify the script is loaded.
- Cart Data & Product Details: Retrieves cart data from Shopify and transforms cart items for Google's ecommerce tracking format.
- Cart Total Value: Computes the total value of items in the cart.
- Begin Checkout Event Listener: It waits for the page to load and then identifies checkout buttons. For each button: Clears previous `dataLayer` ecommerce data on click and pushes new ecommerce data to the `dataLayer` for Google Tag Manager tracking.

```jsx
<script>
  console.log("datalayer-checkout snippet is loaded");

  cart_data = {{ cart | json }};

  var product_details = cart_data.items.map(function(item) {
    return {
      item_id: item.id,
      id: item.id,
      item_name: item.product_title,
      item_brand: item.vendor,
      item_category: item.product_type,
      quantity: item.quantity,
      currency: {{ shop.currency | json }},
      google_business_vertical: 'retail',
      price: parseFloat(item.price / 100.0)
    };
  });

  var cartTotalValue = cart_data.items.reduce(function(acc, item) {
    return acc + (item.price * item.quantity);
  }, 0);

  document.addEventListener('DOMContentLoaded', () => {
    const BeginCheckout = document.querySelectorAll('[name="checkout"]');
    BeginCheckout.forEach((CartItem, index) => {
      CartItem?.addEventListener('click', () => {
        dataLayer.push({ ecommerce: null });
        dataLayer.push({
          event: "custom_begin_checkout",
          ecommerce: {
            items: product_details,
            value: parseFloat(cartTotalValue / 100.0),
            currency: {{ shop.currency | json }}           }
        });
      });
    });
  });
</script>
```

#### Theme DataLayer Code

This code renders the `head-datalayer` snippet. Depending on the setup of your Shopify theme, this is likely where the head datalayer code resides. Add this code GTM Body Code.

```jsx
{% render 'head-datalayer' %}
```

#### Steps to Add the DataLayer Code Snippets in Shopify:

1. Backup: Before making any changes, always backup your current theme.
2. Access Theme Files:
   - Login to your Shopify Admin.
   - Go to Online Store > Themes.
   - Click on the "Actions" dropdown for your live theme and select "Edit code".
3. Add Head DataLayer Code:

   - In the left sidebar, locate and click on `theme.liquid`.
   - Insert the "Head DataLayer Code" snippet within the `<head>` tags.

<Note
 title='Tip'
 content='Always ensure your code is correctly formatted for readability and error prevention.'
/>

4. Add Checkout DataLayer Code:

   - Click "Add a new snippet" depending on your Shopify version.
   - Name it `datalayer-checkout.liquid`.
   - Insert the "Checkout DataLayer Code" snippet into this new file.
   - Save changes.

5. Add Theme DataLayer Code:

   - Determine where you want this code to render (usually within the `<head>` tags in `theme.liquid`).
   - Insert the "Theme DataLayer Code" snippet in the desired location.
   - Save changes.

6. Test:
   - Visit a Cart page on your Shopify store and click BeginChecout button.
   - Open browser's developer console.
   - Confirm that the `custom_begin_checkout` event is fired and the `dataLayer` object contains the correct product details.

<Note
 title='Tip'
 content="The custom prefixes added to event names (like 'custom_begin_checkout') prevent any conflicts with other possible integrations or plugins that might be using standard event names."
/>

<GiscusComments />
